<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crossy Sasquatch â€“ Forest, Roads, Rivers</title>
<style>
    body {
        margin: 0;
        background: #222;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    canvas {
        background: #333;
        border: 3px solid #fff;
    }
</style>
</head>
<body>
<canvas id="game" width="400" height="600"></canvas>

<script>
// =====================================================
// CONFIG
// =====================================================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TILE = 40;

const PLAYER_SIZE = 32;
const CAR_HEIGHT = 30;
const LOG_HEIGHT = 30;

const ROAD = "road";
const GRASS = "grass";
const RIVER = "river";

// How many rows exist (world height). Camera scrolls through them.
const ROW_COUNT = 200;

// Camera offset so player appears centered while moving upward
let cameraY = 0;

// =====================================================
// TERRAIN GENERATION
// =====================================================
let terrainRows = [];

for (let i = 0; i < ROW_COUNT; i++) {
    if (i < 3) {
        terrainRows.push(GRASS);
    } else {
        // Weighted selection
        const r = Math.random();
        if (r < 0.33) terrainRows.push(ROAD);
        else if (r < 0.66) terrainRows.push(GRASS);
        else terrainRows.push(RIVER);
    }
}

// =====================================================
// PLAYER (SASQUATCH)
// =====================================================
let player = {
    x: canvas.width / 2 - PLAYER_SIZE / 2,
    y: (ROW_COUNT - 2) * TILE,
    width: PLAYER_SIZE,
    height: PLAYER_SIZE,
    onLog: null
};

function drawSasquatch(x, y) {
    // Body
    ctx.fillStyle = "#8b5a2b";
    ctx.fillRect(x + 5, y + 8, 24, 26);

    // Head
    ctx.beginPath();
    ctx.arc(x + 17, y + 10, 10, 0, Math.PI * 2);
    ctx.fillStyle = "#8b5a2b";
    ctx.fill();

    // Face patch
    ctx.beginPath();
    ctx.arc(x + 17, y + 12, 6, 0, Math.PI * 2);
    ctx.fillStyle = "#d2b48c";
    ctx.fill();

    // Eyes
    ctx.fillStyle = "black";
    ctx.fillRect(x + 13, y + 7, 3, 3);
    ctx.fillRect(x + 20, y + 7, 3, 3);

    // Legs
    ctx.fillStyle = "#8b5a2b";
    ctx.fillRect(x + 8, y + 28, 8, 10);
    ctx.fillRect(x + 20, y + 28, 8, 10);

    // Arms
    ctx.fillRect(x - 2, y + 15, 8, 12);
    ctx.fillRect(x + 28, y + 15, 8, 12);
}

// =====================================================
// TREES (Grass rows)
// =====================================================
let trees = [];

for (let row = 0; row < ROW_COUNT; row++) {
    if (terrainRows[row] === GRASS) {
        for (let i = 0; i < 2; i++) {
            if (Math.random() < 0.5) {
                trees.push({
                    x: Math.random() * (canvas.width - 32),
                    y: row * TILE
                });
            }
        }
    }
}

function drawTree(x, y) {
    // Trunk
    ctx.fillStyle = "#5d3a1a";
    ctx.fillRect(x + 12, y + 20, 8, 20);

    // Pine shape
    ctx.fillStyle = "#0f6d19";
    ctx.beginPath();
    ctx.moveTo(x, y + 25);
    ctx.lineTo(x + 32, y + 25);
    ctx.lineTo(x + 16, y + 5);
    ctx.closePath();
    ctx.fill();
}

// =====================================================
// CARS (Road rows)
// =====================================================
let cars = [];

function spawnCarRow(row) {
    const direction = Math.random() < 0.5 ? -1 : 1;
    cars.push({
        x: direction === 1 ? -150 : canvas.width + 150,
        y: row * TILE,
        width: 70 + Math.random() * 50,
        height: CAR_HEIGHT,
        speed: (2 + Math.random() * 3) * direction,
        color: ["#e74c3c", "#3498db", "#f1c40f", "#9b59b6"][Math.floor(Math.random() * 4)]
    });
}

terrainRows.forEach((type, row) => {
    if (type === ROAD && Math.random() < 0.8) spawnCarRow(row);
});

function drawCar(car) {
    const { x, y, width, height, color } = car;

    ctx.fillStyle = color;
    ctx.fillRect(x, y - cameraY + 5, width, height);

    // windows
    ctx.fillStyle = "#ecf0f1";
    ctx.fillRect(x + 10, y - cameraY + 8, width * 0.4, height * 0.45);
    ctx.fillRect(x + width * 0.55, y - cameraY + 8, width * 0.3, height * 0.45);

    // wheels
    ctx.fillStyle = "black";
    ctx.fillRect(x + 5, y - cameraY + height + 5, 12, 8);
    ctx.fillRect(x + width - 17, y - cameraY + height + 5, 12, 8);
}

// =====================================================
// LOGS (River rows)
// =====================================================
let logs = [];

function spawnLogRow(row) {
    const direction = Math.random() < 0.5 ? -1 : 1;
    logs.push({
        x: direction === 1 ? -200 : canvas.width + 200,
        y: row * TILE,
        width: 90 + Math.random() * 80,
        height: LOG_HEIGHT,
        speed: (1.5 + Math.random() * 2) * direction
    });
}

terrainRows.forEach((type, row) => {
    if (type === RIVER && Math.random() < 0.9) spawnLogRow(row);
});

function drawLog(log) {
    ctx.fillStyle = "#8b4513";
    ctx.fillRect(log.x, log.y - cameraY + 8, log.width, log.height);

    // bark lines
    ctx.fillStyle = "#5e320c";
    for (let i = 0; i < 5; i++) {
        ctx.fillRect(log.x + 10 + i * 20, log.y - cameraY + 12, 20, 4);
    }
}

// =====================================================
// INPUT
// =====================================================
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// =====================================================
// RESET
// =====================================================
function resetGame() {
    player.x = canvas.width / 2 - PLAYER_SIZE / 2;
    player.y = (ROW_COUNT - 2) * TILE;
    score = 0;
    cameraY = player.y - 400;
}

// =====================================================
// GAME LOOP
// =====================================================
let score = 0;

function update() {
    player.onLog = null;

    // Movement input
    if (keys["ArrowUp"]) {
        player.y -= TILE;
        score++;
        keys["ArrowUp"] = false;
    }
    if (keys["ArrowDown"]) {
        player.y += TILE;
        score = Math.max(score - 1, 0);
        keys["ArrowDown"] = false;
    }
    if (keys["ArrowLeft"] && player.x > 0) {
        player.x -= TILE;
        keys["ArrowLeft"] = false;
    }
    if (keys["ArrowRight"] && player.x < canvas.width - TILE) {
        player.x += TILE;
        keys["ArrowRight"] = false;
    }

    // Move cars
    cars.forEach(car => {
        car.x += car.speed;
        if (car.speed > 0 && car.x > canvas.width + 200) car.x = -200;
        if (car.speed < 0 && car.x < -200) car.x = canvas.width + 200;
    });

    // Move logs
    logs.forEach(log => {
        log.x += log.speed;
        if (log.speed > 0 && log.x > canvas.width + 300) log.x = -300;
        if (log.speed < 0 && log.x < -300) log.x = canvas.width + 300;
    });

    // Collision: Cars
    cars.forEach(car => {
        if (player.x < car.x + car.width &&
            player.x + PLAYER_SIZE > car.x &&
            player.y < car.y + car.height &&
            player.y + PLAYER_SIZE > car.y) {
            resetGame();
        }
    });

    const rowIndex = Math.floor(player.y / TILE);
    const terrain = terrainRows[rowIndex];

    // River behavior: player must stand on log
    if (terrain === RIVER) {
        let safe = false;

        logs.forEach(log => {
            if (player.x < log.x + log.width &&
                player.x + PLAYER_SIZE > log.x &&
                player.y < log.y + log.height &&
                player.y + PLAYER_SIZE > log.y) {
                safe = true;
                player.onLog = log;
            }
        });

        if (!safe) resetGame();
    }

    // If on a log, move with it
    if (player.onLog) {
        player.x += player.onLog.speed;
    }

    // Camera follows player upward
    cameraY = player.y - 300;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw terrain
    for (let i = 0; i < ROW_COUNT; i++) {
        const y = i * TILE - cameraY;
        if (y < -TILE || y > canvas.height + TILE) continue;

        if (terrainRows[i] === GRASS) ctx.fillStyle = "#2e8b57";
        else if (terrainRows[i] === ROAD) ctx.fillStyle = "#444";
        else if (terrainRows[i] === RIVER) ctx.fillStyle = "#3fa9f5";

        ctx.fillRect(0, y, canvas.width, TILE);
    }

    trees.forEach(tree => {
        drawTree(tree.x, tree.y - cameraY);
    });

    cars.forEach(drawCar);
    logs.forEach(drawLog);

    drawSasquatch(player.x, player.y - cameraY);

    // Score
    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.fillText("Score: " + score, 10, 25);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

resetGame();
loop();
</script>
</body>
</html>
